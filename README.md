# Messenger API

–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ .NET 9 –∏ SignalR.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Backend
- **.NET 9** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **ASP.NET Core Web API** - REST API
- **Entity Framework Core 9** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **SQL Server** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **SignalR** - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
- **JWT Bearer** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **AutoMapper** - –º–∞–ø–ø–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–æ–≤
- **FluentValidation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Swagger/OpenAPI** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### UI Applications
- **WinForms** - –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **Console Application** - –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å API

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

### üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞

### üí¨ –ß–∞—Ç—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∏ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)
- –†–æ–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (Member, Admin, Owner) * –±–µ–∑ –¥–æ–ø —Ñ–∏—á
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### üì® –°–æ–æ–±—â–µ–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

### üîÑ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üì¶ –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞


### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```csharp
using Messenger.Client;
using Messenger.Shared;

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
var client = MessengerClientFactory.CreateClient("https://localhost:5001");

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
client.MessageReceived += message => 
    Console.WriteLine($"[NEW] {message.SenderUsername}: {message.Content}");

client.UserTyping += (userId, isTyping) => 
    Console.WriteLine($"[TYPING] User {userId} is {(isTyping ? "typing" : "not typing")}");

// –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
var isAuthenticated = await client.AuthenticateAsync("username", "password");
if (!isAuthenticated)
{
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    await client.RegisterAsync("username", "email@example.com", "password");
    isAuthenticated = await client.AuthenticateAsync("username", "password");
}

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SignalR
await client.ConnectAsync();

// –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤
var chats = await client.GetChatsAsync();

// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
var newChat = await client.CreateChatAsync(new CreateChatDto
{
    Name = "My Chat",
    Description = "Chat description",
    Type = ChatType.Group,
    MemberIds = new List<Guid>()
});

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
var message = await client.SendMessageAsync(new CreateMessageDto
{
    Content = "Hello, world!",
    ChatId = newChat.Id,
    Type = MessageType.Text
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
var messages = await client.GetChatMessagesAsync(newChat.Id, skip: 0, take: 50);

// –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
await client.SendTypingIndicatorAsync(newChat.Id, true);
await Task.Delay(2000);
await client.SendTypingIndicatorAsync(newChat.Id, false);

// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
var users = await client.SearchUsersAsync("john");

// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
await client.DisconnectAsync();
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `AuthenticateAsync(username, password)` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `RegisterAsync(username, email, password)` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `SetToken(token)` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- `ConnectAsync()` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SignalR
- `DisconnectAsync()` - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
- `IsConnected` - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### –ß–∞—Ç—ã
- `GetChatsAsync()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
- `GetChatAsync(chatId)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Ç–µ
- `CreateChatAsync(createChatDto)` - —Å–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
- `UpdateChatAsync(chatId, updateChatDto)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞
- `AddMemberToChatAsync(chatId, memberId)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- `RemoveMemberFromChatAsync(chatId, memberId)` - —É–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- `LeaveChatAsync(chatId)` - –≤—ã—Ö–æ–¥ –∏–∑ —á–∞—Ç–∞
- `DeleteChatAsync(chatId)` - —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞
- `MarkChatAsReadAsync(chatId)` - –æ—Ç–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ

#### –°–æ–æ–±—â–µ–Ω–∏—è
- `GetChatMessagesAsync(chatId, skip, take)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- `GetMessageAsync(messageId)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `GetRepliesAsync(messageId)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- `SendMessageAsync(createMessageDto)` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- `UpdateMessageAsync(messageId, updateMessageDto)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `DeleteMessageAsync(messageId)` - —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `SendTypingIndicatorAsync(chatId, isTyping)` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `SearchUsersAsync(query)` - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GetUserAsync(userId)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GetCurrentUserAsync()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GetOnlineUsersAsync()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°–æ–±—ã—Ç–∏—è

```csharp
// –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
client.MessageReceived += (MessageDto message) => { };

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
client.MessageUpdated += (MessageDto message) => { };

// –£–¥–∞–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
client.MessageDeleted += (Guid messageId) => { };

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —á–∞—Ç—É
client.UserJoinedChat += (Guid chatId) => { };

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç
client.UserLeftChat += (Guid chatId) => { };

// –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
client.UserTyping += (Guid userId, bool isTyping) => { };

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
client.UserOnlineStatusChanged += (Guid userId, bool isOnline) => { };
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Clean Architecture —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏:

- **API** - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ SignalR —Ö–∞–±—ã
- **Application** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
- **Domain** - —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **Infrastructure** - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- **Shared** - –æ–±—â–∏–µ DTO –∏ –º–æ–¥–µ–ª–∏

## üöÄ –ó–∞–ø—É—Å–∫

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `appsettings.json`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ API —Å–µ—Ä–≤–µ—Ä
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
5. –ó–∞–ø—É—Å–∫ —Ä–µ–¥–∏—Å —Å–µ—Ä–≤–∞–∫–∞
6. –ú–æ–ª–∏—Ç–≤—ã

## üìù –ü—Ä–∏–º–µ—Ä—ã

–°–º–æ—Ç—Ä–∏—Ç–µ `Messenger.ConsoleExample` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. 

## üìù –î–µ–º–æ
https://youtu.be/V47sOJG7r8o